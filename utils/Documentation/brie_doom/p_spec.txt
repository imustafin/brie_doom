note
	description: "[
		p_spec.c
		Implements special effects:
		Texture animation, height or lighting changes
		 according to adjacent sectors, respective
		 utility functions, etc.
		Line Tag handling. Line and Sector triggers.
	]"

class 
	P_SPEC

create 
	make

feature 

	make
		do
		end
	
feature 

	Vdoorspeed: INTEGER_32
		once
			Result := {M_FIXED}.fracunit * 2
		ensure
			instance_free: class
		end

	Vdoorwait: INTEGER_32 = 150

	Maxswitches: INTEGER_32 = 50
			-- max # of wall switches in a level

	Maxbuttons: INTEGER_32 = 16
			-- 4 players, 4 buttons each at once, max.

	Buttontime: INTEGER_32 = 35
			-- 1 second, in ticks.
	
feature 

	p_initpicanims
		do
		end

	p_spawnspecials
		do
		end

	p_updatespecials
			-- Animate planes, scroll walls, etc.
		do
		end

	p_playerinspecialsector (player: PLAYER_T)
			-- Called every tic frame
			-- that the player origin is in a special sector
		do
		end

	p_crossspecialline (linenum, side: INTEGER_32; thing: MOBJ_T)
			-- Called every time a thing origin is about
			-- to cross a line with a non 0 special
		do
		end

	p_findlowestceilingsurrounding (sec: SECTOR_T): FIXED_T
		local
			i: INTEGER_32
			ch: LINE_T
			other: SECTOR_T
		do
			Result := create {FIXED_T}.from_integer ({DOOMTYPE_H}.maxint)
			from
				i := sec.lines.Lower
			until
				i > sec.lines.upper
			loop
				ch := sec.lines [i]
				other := getnextsector (ch, sec)
				if attached other then
					if other.ceilingheight < Result then
						Result := other.ceilingheight
					end
				end
				i := i + 1
			end
		end

	getnextsector (line: LINE_T; sec: SECTOR_T): detachable SECTOR_T
			-- Return sector_t * of sector next to current.
			-- NULL if not two-sided line
		do
			if line.flags.to_integer_32 & {DOOMDATA_H}.ml_twosided = 0 then
				Result := Void
			else
				if line.frontsector = sec then
					Result := line.backsector
				else
					Result := line.frontsector
				end
			end
		end

	p_shootspecialline (thing: MOBJ_T; line: LINE_T)
			-- IMPACT SPECIALS
			-- Called when a thing shoots a special line.
		do
			print ("P_ShootSpecialLine not implemented%N")
		end
	
feature -- Special Stuff that can not be categorized

	ev_dodonut (line: LINE_T): BOOLEAN
		do
			{I_MAIN}.i_error ("EV_DoDonut not implemented")
		ensure
			instance_free: class
		end
	
end -- class P_SPEC
